# 计网 | 传输层

## 一 . 半双工与全双工

1. **半双工**

允许数据在两个方向上传输，但是同一时间数据只能在一个方向上传输，其实际上是切换的单工。
栗子：对讲机。
2. **全双工**
允许数据在两个方向上同时传输。
栗子：电话
3. **单工**
数据只在一个方向上传输，不能实现双方通信。
栗子：电视、广播。

## 二. 运输层端口

**1.端口的目的**
识别通信对方主机上的应用进程！
**2.协议端口号**
把所传送的报文传递到目的主机的某个端口，最后交付的目的进程就有UDP或TCP来完成。
注：区别于硬件（路由器或交换机）上的端口，硬件端口是不同硬件设备进行交互的接口，而软件端口是**应用层的各种协议与运输实体进行层间的交互的一种地址。**

## 三. UDP与TCP的区别

**UDP**
udp的包头：
![在这描述](https://img-blog.csdnimg.cn/32402a8897fc420f990d1a3d965d237a.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5YWI6L-bMzPlj7c=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)
由上图可以看出，UDP只有源端口号和目的端口号。

1. **不需要大量的数据结构**，处理逻辑和包头字段。
2. **它不会建立连接**，但是会监听这个地方，谁都可以传给它数据，它也可以传给任何人数据，甚至可以同时传给多个人数据。
3. **不会根据网络的情况进行拥塞控制**，可能发生丢包现象。

主要应用场景：
>需要资源少，网络情况稳定的内网，或者**对于丢包不敏感的应用**，比如 DHCP 就是基于 UDP 协议的。
**不需要一对一沟通**，建立连接，而是可以广播的应用。因为它不面向连接，所以可以做到一对多，承担广播或者多播的协议。
**需要处理速度快**，可以容忍丢包，即使网络拥塞。

栗子：

1. **直播**。直播对实时性的要求比较高，宁可丢包，也不要卡顿的，所以很多直播应用都基于 UDP 实现了自己的视频传输协议
2. **实时游戏**。游戏的特点也是实时性比较高，在这种情况下，采用自定义的可靠的 UDP 协议，自定义重传策略，能够把产生的延迟降到最低，减少网络问题对游戏造成的影响
3. **物联网**。一方面，物联网领域中断资源少，很可能知识个很小的嵌入式系统，而维护 TCP 协议的代价太大了；另一方面，物联网对实时性的要求也特别高。比如 Google 旗下的 Nest 简历 Thread Group，推出了物联网通信协议 Thread，就是基于 UDP 协议的。

**TCP**
TCP的包头
![在这里插入图片描述](https://img-blog.csdnimg.cn/199c687ef038479cba1fa9f83c544699.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5YWI6L-bMzPlj7c=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)
TCP 的包头有哪些内容，分别有什么用?
>首先，源端口和目标端口是不可少的。
接下来是**包的序号**。主要是为了解决乱序问题。不编好号怎么知道哪个先来，哪个后到
**确认序号**。发出去的包应该有确认，这样能知道对方是否收到，如果没收到就应该重新发送，这个解决的是不丢包的问题
**状态位**。SYN 是发起一个链接，ACK 是回复，RST 是重新连接，FIN 是结束连接。因为 TCP 是面向连接的，因此需要双方维护连接的状态，这些状态位的包会引起双方的状态变更
**窗口大小**，TCP 要做流量控制，需要通信双方各声明一个窗口，标识自己当前的处理能力。

通过对 TCP 头的解析，我们知道要掌握 TCP 协议，应该重点关注以下问题：
>顺序问题
丢包问题
连接维护
流量控制
拥塞控制

***三次握手***

SYN:同步位（SYN=1,表示发起一个连接请求）
ACK:确认位（为0则确认无效，为1则确认有效）
ack：确认号（对方发送序号+1）
seq:序号（随机生成）

目的：
>进行三次握手的主要作用就是为了确认双方的接收能力和发送能力是否正常、指定自己的初始化序列号为后面的可靠性传送做准备。实质上其实就是连接服务器指定端口，建立TCP连接，并同步连接双方的序列号和确认号，交换TCP窗口大小信息。(建立一个TCP连接时，需要客户端和服务器总共发送3个包)。
>
[三次握手四次挥手详解](https://blog.csdn.net/hyg0811/article/details/102366854?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163247171516780269888961%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163247171516780269888961&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-102366854.first_rank_v2_pc_rank_v29&utm_term=tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B&spm=1018.2226.3001.4187)

***四次挥手***
FIN=1：在报文中加入FIN，表示要断开链接，客户端会停止向服务端发数据；

为什么握手只要三次而挥手要四次？
因为：为了保证TCP协议的可靠性，设置的三次握手，四次挥手。

为什么要等待一段时间？
原因：有可能发送到服务端的命令丢失了，所以，还会有个等待时间。

**四次挥手为什么要有2MSL的等待时间？（一个close_wait状态）**
首先，MSL是报文最大生成时间。防止第一次发送的ACK丢失，于是再次发送。

1. 确认所有的数据报报文在网络里面消失。以免下一次连接时不会收到上次传输的报文（因为一个报文的时间时30S）；

2. 确保客户端最后的ACK被服务端接受到了（服务端不再重新发送FIN）。

重传计时器远小于MSL，所以即使客户端向服务段发送的ACK没有被接收到，在一个MSL的时间内，服务端仍会向客户端继续发送FIN。

**tcp里面两个重要的计时器**
1.**重传计时器**

>在超时重传中，重点是定时器溢出超时了才认为发送的数据包丢失，快速重传机制，实现了另外的一种丢包评定标准，即如果我连续收到3次dup ACK，发送方就认为这个seq的包丢失了，立刻进行重传，这样如果接收端回复及时的话，基本就是在重传定时器到期之前，提高了重传的效率。

2.**报文确认计时器**

**TCP的流量控制**
**目的:** 一般来说，我们总是希望数据发送的又快又多。但是这样，接收方可能来不及接收。所以要进行流量控制。
**滑动窗口**
**拥塞控制**
[详解](https://blog.csdn.net/qq_42214953/article/details/105832303)

## 四.HTTP和HTTPS的区别

## 五.cookie和session的区别

***cookie***

>1.cookie是一小段存在浏览器端的文本数据，大小不超过4KB；由一个名称和几个值和其他的几个可选属性组成（有效期，安全性，使用范围等）；
2.有些网站使用session机制识别用户的身份，将sessionID存储在Cookie中；发送网络请求时，cookie会在请求头里一起（指将sessionID）发送给客户端；

***session***

>1.session在网络应用中，被称为会话控制。session对象时存储在服务器端的，主要用来存储用户会话所需的属性数据和配置数据。sessionID需要存储在浏览器端（cookie里），浏览器发送接口请求的时候需要带着这个sessionID。（服务器就可以找出当前请用的用户是谁，并给他提供个性化服务）。
>2.session一般会配置一个过期时间，超时则需要用户重新登录。

***面试常见错误***

1.关闭浏览器cookie就一定会失效;
2.不知道cookie时存在浏览器端的;
3.cookie的容量限制回答不上来;
4.不知道cookie和session的关系;
5.不知道cookie和域名，协议，端口之间的关系;
6.不知道sessionID是存储在客户端cookie里面的;
7.认为浏览器禁用cookie，session就不能用了；
8.关闭了浏览器，session就失效了；
9.不知道session共享是干嘛用的。

## 六.DNS原理

**作用** :域名存储服务器，将域名翻译成ip地址。
**DNS劫持**：域名翻译过来的ip地址被篡改。(此时可以手动更改为第三方的DNS)
