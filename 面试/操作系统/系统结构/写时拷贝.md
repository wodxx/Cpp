# 写时拷贝

写时拷贝顾名思义就是“写的时候才分配内存空间”，这实际上是一种拖延战术。(子进程，在读时不额外复制父进程的资源，当进行写操作时，才将父进程的资源进行复制。)

- 传统的 fork() 系统调用直接把所有的资源复制给新创建的进程，这种实现过于简单并且效率低下，因为它拷贝的数据或许可以共享，或者有时候 fork() 创建新的子进程后，子进程往往要调用一种 exec 函数以执行另一个程序。而 exec 函数会用磁盘上的一个新程序替换当前子进程的正文段、数据段、堆段和栈段，如果之前 fork() 时拷贝了内存，则这时被替换了，这是没有意义的。

- Linux 的 fork() 使用写时拷贝（Copy-on-write）页实现。写时拷贝是一种可以推迟甚至避免拷贝数据的技术。**内核此时并不复制整个进程的地址空间，而是让父子进程共享同一个地址空间。只用在需要写入的时候才会复制地址空间，从而使各个进行拥有各自的地址空间**。也就是说，资源的复制是在需要写入的时候才会进行，在此之前，**只有以只读方式共享**。这种技术使地址空间上的页的拷贝被推迟到实际发生写入的时候，大大提高了效率
