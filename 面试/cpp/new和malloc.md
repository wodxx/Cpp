# new和malloc

>new是操作符，malloc是函数。操作符是利用函数实现的比函数更简洁，C++可以对操作符进行重载，操作符在编译阶段处理而函数在代码段中被调用。

C++标准并没有给出new/delete应该如何实现，但很多编译器的new/delete都是以malloc/free为基础来实现的。

**从技术上来说，堆（heap）是C语言和操作系统的术语，堆是操作系统所维护的一块特殊内存，它提供了动态分配的功能，使用malloc()、free（）来申请/释放内存。**

**而自由存储是C++中通过new和delete动态分配和释放对象的抽象概念。**

基本上，所有的C++编译器默认使用堆来实现自由存储。也就是说，默认的全局运算符new和delete也许会使用malloc和free的方式申请和释放存储空间，也就是说自由存储区就位于堆上。但程序员也可以通过重载操作符(new/delete)，改用其他内存来实现自由存储，例如全局变量做的对象池，这时自由存储区就不位于堆上了。

## malloc 的实现原理

malloc 函数的实质是它有一个将可用的内存块连接为一个长长的列表的所谓空闲链表。 调用 malloc（）函数时，它沿着连接表寻找一个大到足以满足用户请求所需要的内存块。（如果没有搜索到，那么就会用sbrk()才推进brk指针来申请内存空间）。 然后，将该内存块一分为二（一块的大小与用户申请的大小相等，另一块的大小就是剩下来的字节）。 接下来，将分配给用户的那块内存存储区域传给用户，并将剩下的那块（如果有的话）返回到连接表上。 调用 free 函数时，它将用户释放的内存块连接到空闲链表上。
