# 数据库索引底层数据结构

得分点： **数据库的底层数据结构为B+树！**

索引可选的底层数据机构包括：

- 二叉树

- 红黑树

- hash

- B-tree

但Mysql索引的底层用的并不是二叉树和红黑树。

***为什么用B+树而不用红黑树或者二叉树***

因为二叉树和红黑树在某些场景下都会暴露出一些缺陷。
首先，**二叉树**在某些场景下会退化成链表，而链表的查找需要从头部开始遍历，而这就失去了加索引的意义；其次，不使用**红黑树**的原因是：红黑树作为底层数据结构在面对在些表数据动辄数百万数千万的场景时，会导致索引树的层数很高。索引从根节点开始查找，而如果我们需要查找的数据在底层的叶子节点上，那么树的高度是多少，就要进行多少次查找，数据存在磁盘上，访问需要进行磁盘IO，这会导致效率过低；同理，二叉树的存储结构也存在着这种问题。

***使用B+树的原因***

而**B+树由B树和索引顺序访问方法演化而来，它是为磁盘或其他直接存取辅助设备设计的一种平衡查找树**

![如下图](https://uploadfiles.nowcoder.com/images/20220226/4107856_1645862987121/3CF9D9131AE159CAE89F36798645787C)

为了减少磁盘IO的次数，必须降低树的深度，因此在**二叉查找树基础上将树改成了多叉加上一些限制条件，就形成了B树**(二叉树的由来)；

B+树中所有叶子节点值的总集就是全部关键字集合；B+树为所有叶子节点增加了链接，从而实现了快速的范围查找； **在B+树中，所有记录节点都是按键值的大小顺序存放在同一层的叶子节点上，由各叶子节点指针进行连接**。
  
B+树索引在数据库中的一个特点就是高扇出性，例如在InnoDB存储引擎中，每个页的大小为16KB。在数据库中，B+树的高度一般都在2～4层，这也就是说查找某一键值的行记录时最多只需要2到4次 IO。这很不错，因为当前一般的机械磁盘每秒至少可以做100次IO，2～4次的IO意味着查询时间只需0.02～0.04秒(查询效率高)。

在数据库中，**B+树索引还可以分为聚集索引和辅助索引**，但不管是聚集索引还是辅助索引，其内部都是B+树的，即高度平衡的，叶子节点存放着所有的数据。聚集索引与辅助索引不同的是，叶子节点存放的是否是一整行的信息。(B+树的分类)
